<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>KlavaDict</title>
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
        <meta name="viewport" content="width=device-width; initial-scale=1;"/>

        <style type="text/css">
            body {background:#dedede; color:#000; font-family:serif, Tinos, Times New Roman;} #card {text-align:center; padding:60px 0; background:#fff; width:500px; min-height:580px; position:absolute; bottom:40px; top:40px; left:50%; margin-left:-250px; box-shadow:5px 5px 5px #ccc; -webkit-box-shadow:5px 5px 5px #ccc; -moz-box-shadow:5px 5px 5px #ccc;} #dict, #result, #select {padding:0 10px;} #dict div {padding:0 40px;} body.mobile #dict div {padding:0;} #errors {position:absolute; border-top:2px solid #f00; display:none;} body.mobile #card {position:relative; margin:10px; padding:10px 0 20px 0; margin-left:0; top:0; left:0; width:inherit; min-height:0;} hr {border:none; background:#fff; color:#fff; border-bottom:2px solid #dedede;} h1 {text-align:center; font-size:34px; font-weight:bold; padding:0 10px; margin:0; margin-bottom:40px; color:#ccc;} body.mobile h1 {margin-bottom:20px;} h2 {text-align:center;} div.t {font-size:14pt; color:#000; font-weight:normal;} b {color:#0a0;} div.card h1 {color:#88c; cursor:pointer; cursor:hand;} div.error h1 {color:#f00;} #advance, #dict, #select {text-align:left; display:inline-block;} #advance {display:block; margin-top:40px; text-align:center;} #advance div {display:inline-block;} #info {font-size:120%; padding:0 40px;} #info input, #info select {font-size:80%;} #result {display:inline-block;} #card a {text-decoration:none; color:#000; font-weight:bold; font-size:20px; min-width:150px; display:block; padding:10px 20px; outline:none;} #card a:focus {outline:1px dotted;} #card a.nooutline:focus {outline:none;} #result div.info {display:inline-block; font-size:20px;} #card a.hover {background-color:#eee;} #card small {font-weight:normal;} #progress {width:0; height:3px; position:absolute; background:#aaa; margin-top:-60px; margin-bottom:60px;} body.mobile #progress {position:absolute; z-index:2; left:0; top:0; margin-top:0;}
        </style>
        <script src="resource/jquery1.4.3.min.js" type="text/javascript"></script>
        <script type="text/javascript">
            var is_animate = $.browser.msie ? false : true;
            $(function() { $(window).resize(function() { mobile(); progress(); }); mobile();
            $('#select a').click(function() { $(this).addClass('select');
            if (is_animate) $('#select').animate({opacity: 0.1}, 'fast', load_dict); else load_dict(); if (is_animate) $('#advance').animate({opacity: 0.1}, 'fast'); return false; });
        
        $('#card a').mouseover(function() {$(this).addClass('hover'); }).hover(function() {$('#card a').removeClass('hover'); $(this).addClass('hover'); }, function() {$(this).removeClass('hover'); }); $($.browser.mozilla ? document : document.body).keydown(function(e) { if (e.keyCode >= 49 && e.keyCode <= 57) { var index = e.keyCode - 48; $('#card div.layer:visible').find('a').eq(index - 1).addClass('hover').click(); } if (e.keyCode == 48) { $('#card div.layer:visible').find('a').eq(9).addClass('hover').click(); } if (e.keyCode == 189) { $('#card div.layer:visible').find('a').eq(10).addClass('hover').click(); } if (e.keyCode == 187) { $('#card div.layer:visible').find('a').eq(11).addClass('hover').click(); } if (e.keyCode >= 97 && e.keyCode <= 105) { var index = e.keyCode - 96; $('#card div.layer:visible').find('a').eq(index - 1).addClass('hover').click(); } }); });
            function show_info() { $('#select').hide(); $('#advance').hide(); $('#info').show(); if (is_animate) $('#info').css({opacity: 0.1}).animate({opacity: 1}, 'fast'); }
            function load_dict() { if (! $('#select a.select').length) return; var href = $('#select a.select').removeClass('select').attr('href').split('#')[1]; $('#card').data('time', new Date()); $('#card').data('count', 0); $('#card').data('error', 0); var dict = href.split('_'); var dict_type = dict[1]; var dict_lang = dict[2]; $('#card').data('lang', dict_lang); if (dict[3]) { dict[2] = dict[2] + '_' + dict[3]; dict.pop(); } var dict_file = dict.join('_'); $('#menu').data('file', dict_file); $(this).parent('div').addClass('selected'); $.ajax({ url: 'dict/'+dict_file + '.txt', success: function(text) { $('#select').hide(); $('#info').hide(); $('#advance').hide(); $('#dict').remove(); $('#card').addClass('card').append('<div id="dict" class="layer"></div>'); $('#dict').data('dict', text.replace(/\r/g, "\n").replace(/\n{2,}/g, "\n").replace(/\t/g, ' ').replace(/ {2,}/g, ' ').replace(/^ +/g, "").replace(/\n +/g, "\n").replace(/ +$/g, "").replace(/ +\n/g, "\n").replace(/^\n/, '').replace(/`(.)/g, '$1́').split("\n")); $('#dict').data('count', 0); $('#dict').data('error', 0); $('#progress').css({width: 0}); progress(); card_generate(); }, error: function(request, status, error) { if (is_animate) $('#dict div').animate({opacity: 1}, 'fast'); if (is_animate) $('#dict h1').animate({opacity: 1}, 'fast'); } }); }
            function check_variant() { var is_true = $('#dict a.selected').parent('div').is('.true'); if (! is_animate) $('#dict a.selected').css({opacity: 'none'}); $('#dict a.selected').removeClass('selected'); var count = $('#dict').data('count'); if (count >= 50) { show_stat(false); } else if (is_true) { var card_start = $('#card').data('card_time'); var time = (new Date()) - card_start; if ((! $('#card').is('.error')) && time >= 7000 && time <= 30000) { var error_items = $('#dict').data('error_items'); if (! error_items) error_items = []; var line_index = $('#dict').data('line'); var line_pos = $('#dict').data('line_pos'); error_items[error_items.length] = [line_index, line_pos]; $('#dict').data('error_items', error_items); }
            card_generate(); } else { var error = $('#dict').data('error'); var error_all = $('#card').data('error'); if (! $('#card').is('.error')) { error ++; error_all ++; } $('#dict').data('error', error); $('#card').data('error', error_all); $('#card').addClass('error');
            var line_index = $('#dict').data('line'); var line_pos = $('#dict').data('line_pos'); var error_items = $('#dict').data('error_items'); if (! error_items) error_items = []; for (var i = 0; i < 3; i++) { error_items[error_items.length] = [line_index, line_pos]; } var dict = $('#dict').data('dict'); for (var i = 0; i < 2; i++) { var vars = dict[line_index].split('=')[1].split(';'); error_items[error_items.length] = [line_index, random(vars.length)]; } $('#dict').data('error_items', error_items); } }
            function progress() { if ($('#card').length) { var count = $('#dict').data('count'); var max_width = $('#card').width(); var progress_val = Math.round((count + 1) / (50 + 1) * max_width); $('#progress').css({width: progress_val}); } }
            function mobile() { if ($(window).width() <= 550) { $(document.body).addClass('mobile'); } else { $(document.body).removeClass('mobile'); } }
            function random(num) { return Math.floor(Math.random() * num); }
            function rand_dict(notin, tword) { var dict = $('#dict').data('dict'); var dict_lang = $('#card').data('lang'); if (! dict.length) return - 1; var index = random(dict.length); var start = index; while ($('#dict a span:contains("' + trim(dict[index].split('=')[0]) + '")').length || (dict[index].length < 5) || (notin.indexOf('|' + index + '|') >= 0)) { index ++; if (index >= dict.length) index = 0; if (index == start) break; } if (dict_lang == 'epo' || dict_lang == 'ses') { var word = trim(dict[index].split('=')[0]); start = index; var tl = tword.substring(tword.length - 1); while ((tl != '' && word.substring(word.length - 1) != tl) || $('#dict a span:contains("' + trim(dict[index].split('=')[0]) + '")').length || (dict[index].length < 5) || (notin.indexOf('|' + index + '|') >= 0)) { index ++; if (index >= dict.length) index = 0; word = trim(dict[index].split('=')[0]); if (index == start) break; } } return index; }
            function trim(str) { return str.replace(/(^\s+)|(\s+$)/g, ''); }
            function show_stat(is_stop) { $('#result').remove(); $('#progress').css({width: 0}); $('#card').removeClass('error').removeClass('card'); var start = $('#card').data('time'); var now = new Date(); var t = new Date(0, 0, 0, 0, 0, 0, now - start); var time = (t.getHours() < 10?'0':'') + t.getHours() + ':' + (t.getMinutes() < 10?'0':'') + t.getMinutes() + ':' + (t.getSeconds() < 10?'0':'') + t.getSeconds(); var count = $('#dict').data('count'); var count_all = $('#card').data('count'); var error = $('#dict').data('error'); var error_all = $('#card').data('error'); var percent = ((count_all == 0) ? 100 : Math.round(error_all / count_all * 100)); var error_items = $('#dict').data('error_items') ? $('#dict').data('error_items').length : 0; $('#dict').hide(); $('#card').append('<div id="result" class="layer"><h1>' + (is_stop ? 'Статистика' : 'Отдохните') + '</h1><div><a class="next" href="#next"><small>1) </small>Продолжить</a></div><div class="info"><p>Слов: <b>' + count + ((count != count_all) ? ' (' + count_all + ')' : '') + '</b>; Ошибок: <b style="color: red;">' + error + ((count != count_all) ? ' (' + error_all + ')' : '') + '</b></p><p>Общий результат: <b>' + (100 - percent) + '%</b></p><p>Время: <b>' + time + '</b></p></div><div><a class="new" href="#dict"><small>2) </small>Другой словарь</a></div></div>'); if (is_animate) $('#result').css({opacity: 0.1}).animate({opacity: 1}, 'fast'); $('#result a').mouseover(function() {$(this).addClass('hover'); }).hover(function() {$('#card a').removeClass('hover'); $(this).addClass('hover'); }, function() {$(this).removeClass('hover'); }); $('#result a.next').click(function() { if (is_animate) $('#dict').css({opacity: 1}, 'fast'); if (is_animate) $('#result').animate({opacity: 0.1}, 'fast', result_next); else result_next(); return false; }); $('#result a.new').click(function() { $('#dict').remove(); if (is_animate) $('#result').animate({opacity: 0.1}, 'fast', result_new); else result_new(); return false; }); }
            function result_next() { $('#card').data('time', new Date()); $('#dict').data('count', 0); $('#dict').data('error', 0); $('#result').remove(); $('#dict').show(); progress(); card_generate(); }
            function result_new() { $('#result').remove(); $('#select').show(); $('#info').hide(); $('#advance').show(); if (is_animate) $('#select').animate({opacity: 1}, 'fast'); if (is_animate) $('#advance').animate({opacity: 1}, 'fast'); }
            function card_generate() { $('#dict').html(''); $('#dict').html('<h1></h1><div><a href="#1"><small>1) </small><span></span></a></div><div><a href="#2"><small>2) </small><span></span></a></div><div><a href="#3"><small>3) </small><span></span></a></div><div><a href="#4"><small>4) </small><span></span></a></div><div><a href="#5"><small>5) </small><span></span></a></div>'); $('#card').removeClass('hint'); $('#dict a').mousedown(function() {$(this).addClass('hover'); }).mouseout(function() {$(this).removeClass('hover'); }); if (is_animate) $('#dict h1').css({opacity: 0.1}); if (is_animate) $('#dict div').css({opacity: 0.1}); $('#dict a').click(function() { $(this).addClass('selected'); var num = $(this).attr('href').split('#')[1]; var is_true = $(this).parent('div').is('.true'); var is_error = $('#card').is('.error'); var is_hint = $('#card').is('.hint'); if (is_true) { var count = $('#dict').data('count'); if (is_animate) $('#dict h1').animate({opacity: 0.1}, 'fast'); $('#dict').data('count', count + 1); var count_all = $('#card').data('count'); $('#card').data('count', count_all + 1); progress(); } if (is_animate && is_true) $('#dict div' + (is_error | is_hint ? '.true' : '')).animate({opacity: 0.1}, 'fast'); if (! is_true) $('#dict div:not(.true)').animate({opacity: 0.1}, 'fast'); if (is_animate) $('#dict').animate({opacity: 1}, 'fast', check_variant); else check_variant(); return false; });
            if (! is_animate) $('#dict div').css({opacity: 1}).css({opacity: 'none'}); $('#card').data('card_time', new Date()); $('#card').addClass('card').removeClass('error'); var dict = $('#dict').data('dict'); var dict_lang = $('#card').data('lang'); var type = ((dict[0].indexOf('[') > 0) ? 'dict' : ((random(2) == 1) ? 'dictrev' : 'dict')); $('#dict a span').text(''); var index = rand_dict('', '');
            var error_items = $('#dict').data('error_items'); var error_index = - 1; var line_pos = - 1; if (error_items && (error_items.length != 0) && (random(50) < error_items.length)) { error_index = random(error_items.length); index = error_items[error_index][0]; line_pos = error_items[error_index][1]; error_items.splice(i, 1); $('#dict').data('error_items', error_items); }
            var line = dict[index]; var eq = line.split('='); var pos = random(5); var ans = eq[1].split(';'); var tword = trim(eq[0]); var notin = '|' + index + '|'; if (line_pos == - 1) line_pos = random(ans.length); $('#dict h1').html(type == 'dictrev' ? trim(ans[line_pos]) : eq[0].split('[')[0] + (eq[0].split('[').length > 1?'<div class="t">[' + trim(eq[0].split('[')[1]) + '</div>':'')).click(function() { if (is_animate) $('#dict').animate({opacity: 0.1}, 'fast', function() {show_stat(true); }); else show_stat(true); }); $('#dict').data('line', index); $('#dict').data('line_pos', line_pos); $('#dict div.true').removeClass('true'); $('#dict a span').eq(pos).text(type == 'dictrev' ? trim(eq[0].split('[')[0]) : trim(ans[line_pos])).parent('a').parent('div').addClass('true'); for (var i = 0; i < 5; i++) { if (i != pos) { var index = rand_dict(notin, tword); notin = notin + '|' + index + '|'; var line = dict[index]; var eq = line.split('='); var ans = eq[1].split(';'); var text = type == 'dictrev' ? trim(eq[0].split('[')[0]) : trim(ans[random(ans.length)]); if (text.length > 80) { var pos = line.substring(0, 79).lastIndexOf(' '); if (pos >= 0) { text = text.substring(0, pos + 1); } else { text = text.substring(0, 79); } } $('#dict a span').eq(i).text(text); } } if (is_animate) $('#dict div').animate({opacity: 1}, 'fast'); if (is_animate) $('#dict h1').animate({opacity: 1}, 'fast'); $('#card a.hover').removeClass('hover'); $(document.body).focus(); }
        </script>
    </head>
    <body>
        <div id="card">
            <div id="progress"></div>
            <div id="select" class="layer">
                <div>
                    <a href="#rus_dict_eng_born" title="Англо-русский словарь на 3200 слов"><small>1)</small>
                        <span>Bourn</span>
                    </a>
                </div>
                <div>
                    <a href="#rus_dict_eng_top2" title="Англо-русский словарь на 3200 слов"><small>1)</small>
                        <span> Англо-русский 3000</span>
                    </a>
                </div>
                <div>
                    <a href="#rus_dict_eng_smtg" title="Англо-русский словарь на 3200 слов с транскрипцией"><small>2)</small>
                        <span> Англо-русский 3000♫</span>
                    </a>
                </div>
                <div>
                    <a href="#rus_dict_eng_mtg2" title="Англо-русский словарь на 7100 слов с большим количеством вариантов перевода"><small>3)</small>
                        <span> Англо-русский 7000+ </span>
                        <small style="font-size: 65%;">(1,3 Мб)</small>
                    </a>
                </div>


            </div>
            <div id="advance">
                <div>
                    <a style="display: inline; color: #88f; font-size: 100%; font-weight: normal; text-decoration: underline;" href="http://dict.reformal.ru/">Отзывы и предложения</a>
                </div>
            </div>
        </div>
    </body>
</html>
